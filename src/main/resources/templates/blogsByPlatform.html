<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head th:insert="~{/toInsert/head.html}">
	<title>EndGame - Gaming Magazine Template</title>
</head>
<body onload="getAllBlogsByPlatform(); getAllGames(); getAllGenres(); getAllPlatforms()">
	<!-- Page Preloder -->
	<div th:insert="~{/toInsert/preloader.html}">
	</div>

	<!-- Header section -->
	<header th:insert="~{/toInsert/header.html}">
	</header>
	<!-- Header section end -->


	<!-- Page top section -->
	<section class="page-top-section set-bg" data-setbg="/img/page-top-bg/1.jpg">
		<div class="page-info">
			<h2 th:text="#{blogs}"></h2>
			<div class="site-breadcrumb">
				<a th:href="@{'/'}" th:text="#{home}"></a>  /
				<a th:href="@{'/allBlogs'}" th:text="#{blogs}"></a>  /
				<span class="site-breadcrumb-disabled-span" th:text="#{platform}"></span>  /
				<span th:text="${platform.platformName}"></span>
			</div>
		</div>
	</section>
	<!-- Page top end-->

	<!-- BLogs section -->
	<section class="games-section">
		<div class="container">
			<a th:href="@{'/addBlog'}" class="btn btn-primary w-25" sec:authorize="hasRole('ROLE_BLOGGER') && !hasRole('ROLE_BAN')" th:text="#{addBlog}"></a>
			<div class="row">
				<div class="col-xl-7 col-lg-8 col-md-7">
					<div class="row allBlogsByPlatform">

					</div>
				</div>
				<div class="col-xl-3 col-lg-4 col-md-5 sidebar game-page-sidebar">
					<div id="stickySidebar">
						<div class="widget-item">
							<div class="categories-widget">
								<h4 class="widget-title" th:text="#{game}"></h4>
								<ul class="allGames">

								</ul>
							</div>
						</div>
						<div class="widget-item">
							<div class="categories-widget">
								<h4 class="widget-title" th:text="#{platform}"></h4>
								<ul class="allPlatforms">

								</ul>
							</div>
						</div>
						<div class="widget-item">
							<div class="categories-widget">
								<h4 class="widget-title" th:text="#{genre}"></h4>
								<ul class="allGenres">

								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Blogs end-->

	<!-- Footer section -->
	<footer class="footer-section" th:insert="~{/toInsert/footer.html}">
	</footer>
	<!-- Footer section end -->


	<!--====== Javascripts & Jquery ======-->
	<div th:insert="~{/toInsert/scripts.html}"></div>

	<script>
		function getAllBlogsByPlatform() {
			const result = new XMLHttpRequest();
			var url = document.location.href
			let sections = url.split('/');
			let lastSection = sections.pop();
			result.open("GET", "http://localhost:8000/blogs/byPlatform/" + lastSection)
			result.send()
			result.onload = function () {
				let allBlogsByPlatform = JSON.parse(this.responseText)
				let content = "";
				if (allBlogsByPlatform != null) {
					for (i = 0; i < allBlogsByPlatform.length; i++) {
						content += "<div class='col-12'>"
						content += "<div class='big-blog-item'>"
						content += "<h5>" + allBlogsByPlatform[i].blogCreateDate + " | " + allBlogsByPlatform[i].blogTitle + "</h5>"
						content += "<img class='news-image' src='/getBlogImage/" + allBlogsByPlatform[i].blogImage + "'>"
						content += "<p class='mt-lg-3 blog-description'>" + allBlogsByPlatform[i].blogDescription + "</p>"
						content += "<p class='blog-game'>[[#{game}]]: <span>" + allBlogsByPlatform[i].games.gameName + "</span></p>"
						content += "<a href='/detailsBlog/" + allBlogsByPlatform[i].blogId + "' class='read-more'>[[#{readMoreBtn}]] &#5125;</a>"
						content += "</div>"
						content += "</div>"
					}
				}
				document.querySelector(".allBlogsByPlatform").innerHTML = content;
			}
		}

		function getAllGames() {
			const result = new XMLHttpRequest();
			result.open("GET", "http://localhost:8000/games")
			result.send()
			result.onload = function () {
				let allGames = JSON.parse(this.responseText)
				let content = ""
				for (i = 0; i < allGames.length; i++) {
					content += "<li>"
					content += "<a href='/blogsByGame/" + allGames[i].gameId + "'>" + allGames[i].gameName + "</a>"
					content += "</li>"
				}
				document.querySelector(".allGames").innerHTML = content;
			}
		}

		function getAllPlatforms() {
			const result = new XMLHttpRequest();
			result.open("GET", "http://localhost:8000/platforms")
			result.send()
			var url = document.location.href
			let sections = url.split('/');
			let selectedPlatformId = sections.pop();
			result.onload = function () {
				let allPlatforms = JSON.parse(this.responseText)
				let content = ""
				for (i = 0; i < allPlatforms.length; i++) {
					content += "<li>"
					if (allPlatforms[i].platformId == selectedPlatformId) {
						content += "<a class='disabled' href='/blogsByPlatform/" + allPlatforms[i].platformId + "'>" + allPlatforms[i].platformName + " &#5125;</a>"
					} else {
						content += "<a href='/blogsByPlatform/" + allPlatforms[i].platformId + "'>" + allPlatforms[i].platformName + "</a>"
					}
					content += "</li>"
				}
				document.querySelector(".allPlatforms").innerHTML = content;
			}
		}

		function getAllGenres() {
			const result = new XMLHttpRequest();
			result.open("GET", "http://localhost:8000/genres")
			result.send()
			result.onload = function () {
				let allGenres = JSON.parse(this.responseText)
				let content = ""
				for (i = 0; i < allGenres.length; i++) {
					content += "<li>"
					content += "<a href='/blogsByGenre/" + allGenres[i].genreId + "'>" + allGenres[i].genreName + "</a>"
					content += "</li>"
				}
				document.querySelector(".allGenres").innerHTML = content;
			}
		}
	</script>

	</body>
</html>
