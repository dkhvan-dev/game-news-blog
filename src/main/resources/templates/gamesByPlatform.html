<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head th:insert="~{/toInsert/head.html}">
	<title>EndGame - Gaming Magazine Template</title>
</head>
<body onload="getAllGamesByPlatform(); getAllGenres(); getAllPlatforms(); getLastNewsByPlatform()">
	<!-- Page Preloder -->
	<div th:insert="~{/toInsert/preloader.html}">
	</div>

	<!-- Header section -->
	<header th:insert="~{/toInsert/header.html}">
	</header>
	<!-- Header section end -->


	<!-- Page top section -->
	<section class="page-top-section set-bg" data-setbg="/img/page-top-bg/1.jpg">
		<div class="page-info">
			<h2>Games</h2>
			<div class="site-breadcrumb">
				<a th:href="@{'/'}">Home</a>  /
				<span>Games</span>
			</div>
		</div>
	</section>
	<!-- Page top end-->




	<!-- Games section -->
	<section class="games-section">
		<div class="container">
			<div class="row">
				<div class="col-xl-7 col-lg-8 col-md-7">
					<div class="row allGamesByPlatform">

					</div>
				</div>
				<div class="col-xl-3 col-lg-4 col-md-5 sidebar game-page-sidebar">
					<div id="stickySidebar">
						<div class="widget-item">
							<div class="categories-widget">
								<h4 class="widget-title">platform</h4>
								<ul class="allPlatforms">

								</ul>
							</div>
						</div>
						<div class="widget-item">
							<div class="categories-widget">
								<h4 class="widget-title">Genre</h4>
								<ul class="allGenres">

								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Games end-->


	<!-- Featured section -->
	<section class="featured-section">
		<div class="featured-bg set-bg" data-setbg="../img/featured-bg.jpg"></div>
		<div class="featured-box">
			<div class="text-box">

			</div>
		</div>
	</section>
	<!-- Featured section end-->


	<!-- Newsletter section -->
	<section class="newsletter-section">
		<div class="container">
			<h2>Subscribe to our newsletter</h2>
			<form class="newsletter-form">
				<input type="text" placeholder="ENTER YOUR E-MAIL">
				<button class="site-btn">subscribe  <img src="img/icons/double-arrow.png" alt="#"/></button>
			</form>
		</div>
	</section>
	<!-- Newsletter section end -->


	<!-- Footer section -->
	<footer class="footer-section" th:insert="~{/toInsert/footer.html}">
	</footer>
	<!-- Footer section end -->


	<!--====== Javascripts & Jquery ======-->
	<div th:insert="~{/toInsert/scripts.html}"></div>

	<script>
		function getAllGamesByPlatform() {
			const result = new XMLHttpRequest()
			var url = document.location.href.charAt(document.location.href.length-1)
			result.open("GET", "http://localhost:8000/games/byPlatform/" + url);
			result.send()
			result.onload = function () {
				let allGamesByGenre = JSON.parse(this.responseText)
				let content = ""
				for (i = 0; i < allGamesByGenre.length; i++) {
					content += "<div class='col-lg-4 col-md-6'>"
					content += "<div class='game-item'>"
					content += "<img src='/getGameImage/" + allGamesByGenre[i].gameImage + "' alt='#'>"
					content += "<h5>" + allGamesByGenre[i].gameName + "</h5>"
					content += "<p>Age restriction: <span class='age-limit'>" + allGamesByGenre[i].gameAge + "+</span></p>"
					content += "<a href='/detailsGame/" + allGamesByGenre[i].gameId + "' class='read-more'>Read More <img src='/img/icons/double-arrow.png' th:alt='#'/></a>"
					content += "</div>"
					content += "</div>"
				}
				document.querySelector(".allGamesByPlatform").innerHTML = content;
			}
		}

		function getAllPlatforms() {
			const result = new XMLHttpRequest();
			result.open("GET", "http://localhost:8000/platforms")
			result.send()
			result.onload = function () {
				let allPlatforms = JSON.parse(this.responseText)
				let content = ""
				var selectedPlatformId = document.location.href.charAt(document.location.href.length-1)
				for (i = 0; i < allPlatforms.length; i++) {
					content += "<li>"
					if (allPlatforms[i].platformId == selectedPlatformId) {
						content += "<a class='disabled' href='/gamesByPlatform/" + allPlatforms[i].platformId + "'>" + allPlatforms[i].platformName + "</a>"
					} else {
						content += "<a href='/gamesByPlatform/" + allPlatforms[i].platformId + "'>" + allPlatforms[i].platformName + "</a>"
					}
					content += "</li>"
				}
				document.querySelector(".allPlatforms").innerHTML = content;
			}
		}

		function getAllGenres() {
			const result = new XMLHttpRequest();
			result.open("GET", "http://localhost:8000/genres")
			result.send()
			result.onload = function () {
				let allGenres = JSON.parse(this.responseText)
				let content = ""
				for (i = 0; i < allGenres.length; i++) {
					content += "<li>"
					content += "<a href='/gamesByGenre/" + allGenres[i].genreId + "'>" + allGenres[i].genreName + "</a>"
					content += "</li>"
				}
				document.querySelector(".allGenres").innerHTML = content;
			}
		}

		function getLastNewsByPlatform() {
			const result = new XMLHttpRequest();
			var url = document.location.href.charAt(document.location.href.length-1)
			result.open("GET", "http://localhost:8000/news/lastNewsByPlatform/"  + url)
			result.send();
			result.onload = function () {
				let lastNews = JSON.parse(this.responseText)
				let content = ""
				if (lastNews != null) {
					content += "<div class='top-meta'>"
					content += "<span>" + lastNews.newsCreateDate + "&nbsp;&nbsp;in&nbsp;&nbsp;</span>"
					content += "<a href='/allGames'>Games</a>"
					content += "</div>"
					content += "<h3>" + lastNews.newsTitle + "</h3>"
					content += "<p>" + lastNews.newsDescription + "</p>"
					content += "<a href='/detailsNews/" + lastNews.newsId + "' class='read-more'>Read More <img src='../img/icons/double-arrow.png' alt='#'/></a>"
				} else {
					content = "NO ONE NEWS"
				}
				document.querySelector(".text-box").innerHTML = content;
			}
		}
	</script>

	</body>
</html>
