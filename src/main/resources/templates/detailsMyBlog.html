<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head th:insert="~{/toInsert/head.html}">
    <title>Admin Panel</title>
</head>
<body onload="getBlogById()">

    <div th:insert="~{/toInsert/preloader.html}"></div>

    <!-- Header section -->
    <header th:insert="~{/toInsert/header.html}">
    </header>
    <!-- Header section end -->

    <main class="d-flex flex-column profileSection">
        <div class="container mt-3">
            <div class="alert alert-success" role="alert" th:if="${param.success}" th:text="#{successEditMyBlog}">

            </div>
            <div class="alert alert-danger" role="alert" th:if="${param.errorEditBlog}" th:text="#{errorEditBlog}">

            </div>
            <div class="blogInfo">

            </div>
        </div>
    </main>

    <!-- Footer section -->
    <footer class="footer-section" th:insert="~{/toInsert/footer.html}">
    </footer>
    <!-- Footer section end -->

    <div th:insert="~{/toInsert/scripts.html}"></div>

    <script>
        function getBlogById() {
            const res = new XMLHttpRequest()
            let blogId = document.location.href.split("/").pop();
            res.open("GET", "http://localhost:8000/blogs/" + blogId)
            res.send()
            res.onload = function () {
                let blog = JSON.parse(this.responseText)
                const resGames = new XMLHttpRequest()
                resGames.open("GET", "http://localhost:8000/games")
                resGames.send()
                resGames.onload = function () {
                    let allGames = JSON.parse(resGames.responseText)
                    const resStatus = new XMLHttpRequest()
                    resStatus.open("GET", "http://localhost:8000/blogStatus")
                    resStatus.send()
                    resStatus.onload = function () {
                        let allStatus = JSON.parse(resStatus.responseText)
                        let content = ""
                        content += "<form class='mb-5' action='/editBlog' method='post' encType='multipart/form-data'>"
                        content += "<input type='hidden' name='blogId' value='" + blog.blogId + "'>"
                        content += "<div class='mt-3'>"
                        content += "<label class='inputDetailsLabel'>"
                        content += "<span>[[#{title}]]:</span>"
                        content += "<input type='text' class='form-control' name='blogTitle' value='" + blog.blogTitle + "' placeholder='" + blog.blogTitle + "' required>"
                        content += "</label>"
                        content += "</div>"
                        content += "<div class='mt-3'>"
                        content += "<label class='textAreaLabel'>"
                        content += "<span>[[#{descriptionFeedback}]]:</span>"
                        content += "<textarea maxlength='10000' rows='10' id='tinyMceTextarea' class='form-control' name='blogDescription'>" + blog.blogDescription + "</textarea>"
                        content += "</label>"
                        content += "</div>"
                        content += "<div class='mt-3'>"
                        content += "<label>"
                        content += "<span>[[#{createDate}]]:</span>"
                        content += "<input type='date' class='form-control' name='createDate' value='" + blog.blogCreateDate + "'>"
                        content += "</label>"
                        content += "</div>"
                        content += "<div class='mt-3'>"
                        content += "<label>"
                        content += "<span>[[#{updateDate}]]:</span>"
                        content += "<input type='date' class='form-control' name='updateDate' value='" + blog.blogUpdateDate + "' readOnly>"
                        content += "</label>"
                        content += "</div>"
                        content += "<div class='mt-3'>"
                        content += "<label class='form-label'>"
                        content += "<span>[[#{image}]]:</span> <br>"
                        content += "<img class='img-thumbnail gameImageAdmin' src='/getBlogImage/" + blog.blogImage + "'>"
                        content += "<input type='hidden' name='blogImage' value='" + blog.blogImage + "'>"
                        content += "<input class='form-control mt-3' type='file' name='blogImageToken'>"
                        content += "</label>"
                        content += "</div>"
                        content += "<div class='mt-3'>"
                        content += "<select class='form-select mt-3' name='games'>"
                        for (i = 0; i < allGames.length; i++) {
                            if (allGames[i].gameId == blog.games.gameId) {
                                content += "<option value='" + allGames[i].gameId + "' selected>" + allGames[i].gameName + "</option>"
                            } else {
                                content += "<option value='" + allGames[i].gameId + "'>" + allGames[i].gameName + "</option>"
                            }
                        }
                        content += "</select>"
                        content += "</div>"
                        content += "<div class='mt-3'>"
                        content += "<label class='form-label'>"
                        content += "<span>[[#{author}]]:</span>"
                        content += "<span>" + blog.users.userFirstName + ' ' + blog.users.userSurname + "</span>"
                        content += "<input class='form-control' type='hidden' name='users' value='" + blog.users.userId + "'>"
                        content += "</label>"
                        content += "</div>"
                        content += "<div class='mt-3'>"
                        content += "</div>"
                        content += "<button class='btn btn-primary mt-3'>[[#{editBlog}]]</button>"
                        content += "<button type='button' class='btn btn-danger mt-3' data-bs-toggle='modal' data-bs-target='#deleteBlogAdmin'>[[#{deleteBtn}]]</button>"
                        content += "</form>"
                        content += "<div class='modal fade' id='deleteBlogAdmin' tabIndex='-1' aria-hidden='true'>"
                        content += "<div class='modal-dialog'>"
                        content += "<form action='/deleteBlogAdmin' method='post'>"
                        content += "<div class='modal-content'>"
                        content += "<div class='modal-header'>"
                        content += "<h5 class='modal-title'>[[#{deleteBlog}]]</h5>"
                        content += "<button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button>"
                        content += "</div>"
                        content += "<div class='modal-body'>"
                        content += "<span>[[#{deleteBlogBody}]]</span>"
                        content += "<input type='hidden' name='blogId' value='" + blog.blogId + "' id='blogId'>"
                        content += "</div>"
                        content += "<div class='modal-footer'>"
                        content += "<button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>[[#{closeBtn}]]</button>"
                        content += "<button class='btn btn-danger'>[[#{deleteBlog}]]</button>"
                        content += "</div>"
                        content += "</div>"
                        content += "</form>"
                        content += "</div>"
                        content += "</div>"
                        document.querySelector(".blogInfo").innerHTML = content
                    }
                }
            }
        }
    </script>
</body>
</html>
